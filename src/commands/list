#!/bin/bash

###START###

function list_command {
    require_dir $SCRIPTS_DIR
    all_scripts=$(ls $SCRIPTS_DIR)
    filter_tag=${VALUES[0]}

    if [ -z "$all_scripts" ]
    then
        log "No scripts found in $SCRIPTS_DIR"
        myexit 0
    fi
    
    if [ -n "$filter_tag" ]
    then
        log "Filtering by tag: $filter_tag"
    fi

    log "Available scripts:"

    for script in $all_scripts
    do
        description=$(cat "$SCRIPTS_DIR/$script" | grep -m 1 -o "#??.*")
        tags=$(cat "$SCRIPTS_DIR/$script" | grep -m 1 -o "#&&.*")
        tags="[${tags:3}]"

        if [ -n "$description" ]
        then
            description="${description:3}"
        fi

        if [ "$tags" == "[]" ]
        then
            tags=""
        fi
        printf "  %-20s %s %s\n" "$script" "$description" "$tags"
    done

}

# Print help for the list command
function list_help {
    log "  list|ls [tag] - List all available commands"
    log "      tag - If provided, only scripts with the specified tag will be listed"
    log ""
}

# Short form of the list command
function ls_command {
    list_command $*
}

###END###